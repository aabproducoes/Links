<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Resume</title>
  <meta
    name="description"
    content="Antonio Augusto Barbaro's resume. Check out qualifications, social links, and contact information."
  />
  <meta
    name="keywords"
    content="Resume, Antonio Augusto Barbaro, Qualifications, Social Links, Contact Information"
  />
  <meta name="author" content="Antonio Augusto Barbaro" />

  <!-- Import Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Poppins:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    /* [Your existing CSS styles here] */
    /* For brevity, CSS is omitted since it remains unchanged */
  </style>
</head>
<body>
  <!-- [Your existing HTML structure here] -->
  <!-- For brevity, HTML structure is omitted since it remains unchanged -->

  <!-- Lightning Effect Canvas -->
  <canvas id="lightningCanvas"></canvas>

  <!-- Lightning Effect Script -->
  <script>
    // [Your existing Lightning Effect JavaScript here]
    /* For brevity, Lightning Effect script is omitted since it remains unchanged */
  </script>

  <!-- Main Script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script>
    let selectedLanguage = 'en';

    window.addEventListener('DOMContentLoaded', () => {
      initializeLanguageSelector();
      setupMenu();
      fetchTranslations();
      fetchKnowledgeList();
      fetchCertificationsList();
      showSection('profile'); // Show the profile section by default
    });

    function initializeLanguageSelector() {
      const languageSelect = document.getElementById("language");
      if (localStorage.getItem('selectedLanguage')) {
        selectedLanguage = localStorage.getItem('selectedLanguage');
        languageSelect.value = selectedLanguage;
      }
      languageSelect.addEventListener('change', () => {
        selectedLanguage = languageSelect.value;
        localStorage.setItem('selectedLanguage', selectedLanguage);
        changeLanguage();
      });
    }

    function changeLanguage() {
      fetchTranslations();
      fetchKnowledgeList();
      fetchCertificationsList();
    }

    function fetchTranslations() {
      const translations = {
        "en": {
          "socialLinks": "Social Links & Projects",
          "friendlySites": "Friendly Sites",
          "certifications": "Certifications",
          "contact": "Contact",
          "knowledge": "Knowledge",
          "whatsapp": "WhatsApp",
          "email": "Email",
          "facebook": "Facebook",
          "twitter": "Twitter",
          "instagram": "Instagram",
          "blenderprojects": "Blender Projects",
          "gimpprojects": "Gimp Projects",
          "blenderanimation": "Blender Animation",
          "newtabreplacement": "New Tab Replacement",
          "animatedbackground": "Animated Background",
          "profile": "Profile"
        },
        "pt": {
          "socialLinks": "Redes Sociais & Projetos",
          "friendlySites": "Sites Amigos",
          "certifications": "Certificações",
          "contact": "Contato",
          "knowledge": "Conhecimentos",
          "whatsapp": "WhatsApp",
          "email": "Email",
          "facebook": "Facebook",
          "twitter": "Twitter",
          "instagram": "Instagram",
          "blenderprojects": "Projetos Blender",
          "gimpprojects": "Projetos Gimp",
          "blenderanimation": "Animação Blender",
          "newtabreplacement": "Substituição da Nova Guia",
          "animatedbackground": "Fundo Animado",
          "profile": "Perfil"
        }
      };

      const data = translations[selectedLanguage] || translations["en"];

      console.log(`Updating translations for language: ${selectedLanguage}`);

      // Update section titles
      document.querySelectorAll('.content-section h2').forEach(el => {
        const id = el.parentElement.id;
        if (data[id]) {
          console.log(`Updating title for section: ${id}`);
          el.innerText = data[id];
        }
      });

      // Update menu items
      document.querySelectorAll('.menu-item').forEach(el => {
        const section = el.getAttribute('data-section');
        if (data[section]) {
          console.log(`Updating menu item: ${section}`);
          el.innerText = data[section];
        }
      });

      // Update project links
      const projectLinks = document.querySelectorAll('.project-links a');
      projectLinks.forEach(link => {
        const key = link.textContent.replace(/\s+/g, '').toLowerCase();
        if (data[key]) {
          console.log(`Updating project link: ${key}`);
          link.textContent = data[key];
        }
      });

      // Update social links
      const socialLinks = document.querySelectorAll('.social-links > li > a');
      socialLinks.forEach(link => {
        const key = link.textContent.replace(/\s+/g, '').toLowerCase();
        if (data[key]) {
          console.log(`Updating social link: ${key}`);
          link.textContent = data[key];
        }
      });

      // Update friendly sites links
      const friendlySitesLinks = document.querySelectorAll('.friendly-sites a');
      friendlySitesLinks.forEach(link => {
        const key = link.textContent.replace(/\s+/g, '').toLowerCase();
        if (data[key]) {
          console.log(`Updating friendly site link: ${key}`);
          link.textContent = data[key];
        }
      });

      // Update Contact links
      const whatsappLink = document.getElementById('whatsappLink');
      if (whatsappLink) {
        console.log('Updating WhatsApp link');
        whatsappLink.textContent = `${data.whatsapp}: 54984181968`;
      }

      const emailLink = document.getElementById('emailLink');
      if (emailLink) {
        console.log('Updating Email link');
        emailLink.textContent = `${data.email}: aaugusto444@gmail.com`;
      }
    }

    function fetchKnowledgeList() {
      fetch('./KnowledgeList/KnowledgeList.txt')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Failed to fetch KnowledgeList.txt: ${response.status} ${response.statusText}`);
          }
          return response.text();
        })
        .then(data => {
          const knowledgeList = document.getElementById("knowledge-list");
          if (!knowledgeList) {
            console.error('Knowledge list element not found');
            return;
          }
          knowledgeList.innerHTML = '';

          const lines = data.split('\n').filter(line => line.trim() !== '');
          console.log(`Loading ${lines.length} knowledge items`);

          lines.forEach(line => {
            const [enText, ptText] = line.split('||');
            const listItem = document.createElement('li');
            listItem.textContent = selectedLanguage === 'pt' ? (ptText ? ptText.trim() : '') : (enText ? enText.trim() : '');
            knowledgeList.appendChild(listItem);
          });
        })
        .catch(error => console.error('Error loading knowledge list:', error));
    }

    async function fetchCertificationsList() {
      try {
        console.log('Fetching certifications list...');
        const response = await fetch('./Certificados/CertificadosList.txt');
        if (!response.ok) {
          throw new Error(`Failed to fetch CertificadosList.txt: ${response.status} ${response.statusText}`);
        }

        const data = await response.text();
        const certificationsList = document.getElementById("certifications-list");
        if (!certificationsList) {
          console.error('Certifications list element not found');
          return;
        }
        certificationsList.innerHTML = '';

        const lines = data.split('\n').filter(line => line.trim() !== '');
        console.log(`Total certifications found: ${lines.length}`);

        // Process only the first non-empty, correctly formatted line
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue; // skip empty lines
          const [filePart, titlePart] = line.split(':');
          if (filePart && titlePart) {
            console.log(`Processing certification: ${filePart}`);
            const file = filePart.trim().replace(/["']/g, '');
            const titles = titlePart.split('||');
            const enTitle = (titles[0] && titles[0].trim()) || "Untitled Certification";
            const ptTitle = (titles[1] && titles[1].trim()) || "Certificação Sem Título";

            const listItem = document.createElement('li');

            const certTitle = document.createElement('div');
            certTitle.classList.add('cert-title');
            certTitle.textContent = selectedLanguage === 'pt' ? ptTitle : enTitle;

            const pdfCanvas = document.createElement('canvas');
            pdfCanvas.classList.add('pdf-canvas');
            pdfCanvas.id = `pdf-canvas-${file}`;

            listItem.appendChild(certTitle);
            listItem.appendChild(pdfCanvas);
            certificationsList.appendChild(listItem);

            // Render the first page of the PDF
            console.log(`Rendering PDF: ./Certificados/${file}`);
            renderFirstPage(`./Certificados/${file}`, pdfCanvas.id);
            break; // Stop after processing the first certification
          } else {
            console.warn(`Skipping invalid line in CertificadosList.txt: ${line}`);
          }
        }
      } catch (error) {
        console.error('Error loading certifications list:', error);
        alert('An error occurred while loading the certifications list. Please try again later.');
      }
    }

    function renderFirstPage(pdfUrl, canvasId) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) {
        console.error(`Canvas element not found: ${canvasId}`);
        return;
      }
      const context = canvas.getContext('2d');

      console.log(`Loading PDF: ${pdfUrl}`);
      pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
        console.log(`PDF loaded: ${pdfUrl}`);
        return pdf.getPage(1);
      }).then(page => {
        console.log(`Rendering page 1 of PDF: ${pdfUrl}`);
        const scale = 1.5;
        const viewport = page.getViewport({ scale });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const renderContext = {
          canvasContext: context,
          viewport: viewport
        };
        return page.render(renderContext).promise;
      }).then(() => {
        console.log(`Page rendered for PDF: ${pdfUrl}`);
      }).catch(error => {
        console.error(`Error rendering PDF ${pdfUrl}:`, error);
      });
    }

    function setupMenu() {
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        item.addEventListener('click', () => {
          menuItems.forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          const sectionId = item.getAttribute('data-section');
          showSection(sectionId);
        });
      });
    }

    function showSection(sectionId) {
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(section => {
        section.style.display = section.id === sectionId ? 'block' : 'none';
      });
    }
  </script>
</body>
</html>
