import bpy
import math

# Clean up: remove default mesh objects
bpy.ops.object.select_all(action='DESELECT')
bpy.ops.object.select_by_type(type='MESH')
bpy.ops.object.delete()

# Function to generate star vertices in the XY plane
def create_star_verts(inner_radius, outer_radius, points):
    verts = []
    angle = math.pi / points  # half angle between star points
    for i in range(points * 2):
        # Alternate between outer and inner radius
        r = outer_radius if i % 2 == 0 else inner_radius
        theta = i * angle
        x = r * math.cos(theta)
        y = r * math.sin(theta)
        verts.append((x, y, 0))
    return verts

# Parameters for the star shape
points = 5
outer_radius = 1.0
inner_radius = 0.5

# Create vertices and face (one face using all vertices)
verts = create_star_verts(inner_radius, outer_radius, points)
faces = [list(range(points * 2))]

# Create the mesh and object
mesh = bpy.data.meshes.new("StarMesh")
mesh.from_pydata(verts, [], faces)
mesh.update()

star_obj = bpy.data.objects.new("Star", mesh)
bpy.context.collection.objects.link(star_obj)
bpy.context.view_layer.objects.active = star_obj
star_obj.select_set(True)

# Add an Array modifier to duplicate the star
array_mod = star_obj.modifiers.new("Array", 'ARRAY')
array_mod.count = 10  # number of duplicates

# Use constant offset for spacing along X-axis (change as needed)
array_mod.use_constant_offset = True
array_mod.constant_offset_displace = (2.0, 0, 0)

# Use an Empty object to rotate each array element
empty = bpy.data.objects.new("Empty", None)
bpy.context.collection.objects.link(empty)
array_mod.use_object_offset = True
array_mod.offset_object = empty

# Set initial rotation of the empty (no rotation at frame 1)
empty.rotation_euler = (0, 0, 0)
empty.keyframe_insert(data_path="rotation_euler", frame=1)

# Rotate the empty 360Â° over 120 frames so that each array element is rotated relative to its neighbor
empty.rotation_euler = (0, 0, math.radians(360))
empty.keyframe_insert(data_path="rotation_euler", frame=120)

# Set keyframes to use linear interpolation for a constant rotation speed
if empty.animation_data and empty.animation_data.action:
    for fcurve in empty.animation_data.action.fcurves:
        for kp in fcurve.keyframe_points:
            kp.interpolation = 'LINEAR'
