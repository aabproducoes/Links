<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfólio — AAB Produções</title>
  <meta name="color-scheme" content="dark light">
  <style>
    /* ===== THEME TOKENS (escuro / claro) ===== */
    body{ margin:0; font:14.5px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; }
    body[data-theme="dark"]{
      --bg:#0b0d12; --panel:#0f131b; --muted:#97a0b0; --text:#e6ebf2;
      --accent:#00e0ff; --accent-2:#00ff87; --border:#1a2230;
      --soft:#111826; --soft-2:#0f1722; --glowA: rgba(0,224,255,.06); --glowB: rgba(0,224,255,.15);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      background:radial-gradient(1200px 800px at -10% -20%, #101525 0%, var(--bg) 50%, #0a0d13 100%);
      color:var(--text);
    }
    body[data-theme="light"]{
      --bg:#f5f7fb; --panel:#ffffff; --muted:#5d6778; --text:#0e1726;
      --accent:#007bff; --accent-2:#21c97a; --border:#dfe6ee;
      --soft:#f2f6fb; --soft-2:#eef3fa; --glowA: rgba(0,123,255,.08); --glowB: rgba(0,123,255,.25);
      --shadow: 0 10px 30px rgba(10,35,80,.10);
      background:linear-gradient(180deg, #f7faff 0%, #edf3fb 100%);
      color:var(--text);
    }
    :root{ color-scheme: light dark }
    *{ box-sizing: border-box }
    .app{ display:flex; min-height:100dvh; gap:0 }

    /* ===== SIDEBAR ===== */
    .sidebar{
      width: 300px; max-width: 85vw; background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 95%, transparent) 0%, var(--panel) 100%);
      border-right:1px solid var(--border); position:relative; box-shadow: var(--shadow);
      display:flex; flex-direction:column; min-width:240px; touch-action: pan-y;
    }
    .brand{ padding:16px 16px 8px; border-bottom:1px solid var(--border) }
    .brand h1{ margin:0; font-size:18px; letter-spacing:.3px; display:flex; align-items:center; gap:8px }
    .badge{ font-size:11px; padding:2px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted) }

    .about{
      padding:12px 16px; border-bottom:1px solid var(--border);
      display:grid; grid-template-columns:40px 1fr; gap:12px; align-items:center;
    }
    .avatar{
      width:40px; height:40px; border-radius:12px; object-fit:cover; display:block;
      box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent);
    }
    .about h2{ margin:0; font-size:14px }
    .about p{ margin:.25rem 0 0; font-size:12.5px; color:var(--muted) }

    /* Sociais */
    .socials{ display:flex; gap:8px; margin-top:8px }
    .socials a{
      width:28px; height:28px; border-radius:10px; display:grid; place-items:center;
      border:1px solid var(--border); background:var(--soft);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, filter .18s ease;
    }
    .socials a:hover{
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
      border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
      filter: saturate(1.2);
    }
    .socials svg{ width:16px; height:16px }

    .search{ padding:10px 12px 0 }
    .search input{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid color-mix(in oklab, var(--border) 80%, transparent);
      background:var(--soft); color:var(--text); outline:none;
    }
    .search input:focus{ box-shadow:0 0 0 2px var(--glowB) }
    .link mark{ background:transparent; color:inherit; text-decoration:underline }

    nav{ padding:10px 8px 14px 8px; overflow:auto; flex:1 }
    .link{
      appearance:none; width:100%; text-align:left; border:0; background:transparent; color:var(--text);
      padding:12px 14px; margin:6px; border-radius:14px; cursor:pointer; position:relative; outline:none; display:flex; align-items:center; gap:10px;
    }
    .link .dot{ width:10px; height:10px; border-radius:50%; background:linear-gradient(135deg, var(--accent), var(--accent-2)); opacity:.9; box-shadow:0 0 12px color-mix(in oklab, var(--accent) 50%, transparent) }
    .link .label{ flex:1 }
    .link .open{ opacity:.6; font-size:12px; border:1px solid color-mix(in oklab, var(--border) 80%, transparent); padding:2px 8px; border-radius:999px }
    .link:hover{ background:var(--soft) }
    .link:focus-visible{ box-shadow: 0 0 0 2px var(--glowB) }

    /* Dobrinha/triângulo animado no canto superior direito do botão ativo */
    .link.active{
      background:linear-gradient(180deg, var(--soft-2), var(--soft));
      border:1px solid color-mix(in oklab, var(--accent) 30%, var(--border));
      box-shadow:
        inset 0 0 0 1px color-mix(in oklab, var(--accent) 35%, transparent),
        inset 0 0 24px var(--glowA),
        0 6px 22px rgba(0,0,0,.08);
    }
    .link.active::before{
      content:""; position:absolute; inset:-1px; border-radius:14px; pointer-events:none; z-index:-1;
      background: conic-gradient(from 0deg at 0% 50%, var(--accent), transparent 45%),
                  conic-gradient(from 180deg at 0% 50%, var(--accent-2), transparent 45%);
      filter: blur(16px); opacity:.2;
    }
    .link.active::after{ /* dobrinha */
      content:""; position:absolute; top:6px; right:6px; width:18px; height:18px;
      background: linear-gradient(135deg, rgba(255,255,255,.9), rgba(255,255,255,.25));
      clip-path: polygon(100% 0, 0 0, 100% 100%);
      box-shadow: -1px 1px 2px rgba(0,0,0,.28) inset, -1px 1px 0 rgba(0,0,0,.15);
      transform-origin: 100% 0;
      animation: pagefold 3s ease-in-out infinite;
    }
    @keyframes pagefold{
      0%,100% { transform: rotate(0deg) skewX(0deg) scale(1); opacity:.95 }
      50%     { transform: rotate(-9deg) skewX(-6deg) scale(1.05); opacity:1 }
    }

    .hint{ margin:8px 14px 0; color:var(--muted); font-size:12px }

    /* Resizer */
    .resizer{ position:absolute; right:-3px; top:0; width:6px; height:100%; cursor: col-resize; background: transparent; }
    .resizer::after{ content:""; position:absolute; inset:0; opacity:0; transition:.2s; background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 40%, transparent), transparent 60%) }
    .resizer:hover::after, .resizing .resizer::after{ opacity:.6 }

    /* ===== MAIN PANE ===== */
    .main{ flex:1; min-width:0; position:relative; display:flex; flex-direction:column }
    .toolbar{
      display:flex; gap:8px; align-items:center; justify-content:space-between;
      padding:10px 12px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, color-mix(in oklab, var(--panel) 85%, transparent), var(--panel));
    }
    .toolbar .left, .toolbar .right{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .btn{ color:var(--text); background:var(--soft); border:1px solid color-mix(in oklab, var(--border) 80%, transparent); padding:8px 10px; border-radius:12px; cursor:pointer; user-select:none }
    .btn:hover{ filter:brightness(1.03) }
    .btn:focus-visible{ outline:none; box-shadow: 0 0 0 2px var(--glowB) }
    .title{ font-size:13px; color:var(--muted) }
    .title strong{ color:var(--text) }
    .viewer{ position:relative; flex:1; min-height:0 }
    iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; background:var(--bg) }
    .loading{
      position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
      background: radial-gradient(600px 300px at 50% -10%, var(--glowA), transparent 40%);
    }
    .spinner{
      width:56px; height:56px; border-radius:50%; border:3px solid rgba(127,127,127,.18);
      border-top-color: var(--accent); border-right-color: var(--accent-2);
      animation: spin 1s linear infinite; filter: drop-shadow(0 0 14px color-mix(in oklab, var(--accent) 45%, transparent));
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    /* Faixas de rolagem para trocar seção (topo/rodapé) */
    .edge{ position:absolute; left:0; right:0; height:18px; z-index:5; pointer-events:auto; background:transparent }
    #edgeTop{ top:0 }
    #edgeBottom{ bottom:0 }

    .footer{
      padding:8px 12px; border-top:1px solid var(--border); color:var(--muted); font-size:12px;
      background:linear-gradient(180deg, color-mix(in oklab, var(--panel) 85%, transparent), var(--panel));
    }

    /* ===== OVERLAY DE ATALHOS ===== */
    #kbdOverlay[hidden]{ display:none }
    #kbdOverlay{
      position:fixed; inset:0; background:color-mix(in oklab, var(--bg) 80%, black);
      display:grid; place-items:center; z-index:9999;
    }
    .kbd-card{
      width:min(560px, 92vw); background:var(--panel); color:var(--text); border:1px solid var(--border);
      border-radius:14px; padding:16px; box-shadow:0 10px 40px rgba(0,0,0,.4);
    }
    .kbd-card h2{ margin:0 0 8px 0 }
    .kbd-card ul{ margin:0 0 12px 18px; padding:0 }
    .kbd-card kbd{
      border:1px solid color-mix(in oklab, var(--border) 75%, transparent);
      border-bottom-width:2px; border-radius:6px; padding:2px 6px; background:var(--soft);
      font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    /* ===== REDUZIR MOVIMENTOS ===== */
    .reduced-motion *{ transition: none !important; animation: none !important }
    .reduced-motion .spinner{ display:none }

    /* ===== MOBILE ===== */
    .hamburger{ display:none }
    @media (max-width: 860px){
      .app{ flex-direction:column }
      .sidebar{ width:100% !important; border-right:0; border-bottom:1px solid var(--border) }
      .resizer{ display:none }
      .hamburger{ display:inline-flex }
      nav{ display:none }
      .sidebar.open nav{ display:block; max-height:60vh }
    }
  </style>
</head>
<body data-theme="dark">
  <div class="app" id="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <h1>
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="url(#g)" d="M12 2L2 7l10 5 10-5-10-5Zm0 7L2 4v13l10 5 10-5V4l-10 5Z"/><defs>
              <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#00e0ff"/><stop offset="1" stop-color="#00ff87"/>
              </linearGradient>
            </defs>
          </svg>
          Portfólio <span class="badge">AAB</span>
        </h1>
      </div>

      <div class="about">
        <img
          class="avatar"
          src="https://aabproducoes.github.io/Links/images/292440780_2225688030932761_1836941331334930994_n.webp.png"
          alt="Foto de perfil de Antonio Augusto Barbaro"
          loading="lazy" decoding="async"
        />
        <div>
          <h2>Antonio A. Barbaro</h2>
          <p>Fotografia, HTML5/Games e projetos criativos — <strong>AAB Produções</strong>.</p>
          <div class="socials" aria-label="Redes sociais">
            <a href="https://aabproducoes.github.io" target="_blank" rel="noopener" title="Site">
              <!-- globe -->
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18"/></svg>
            </a>
            <a href="https://github.com/aabproducoes" target="_blank" rel="noopener" title="GitHub">
              <!-- github -->
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.1c-3.34.73-4.04-1.61-4.04-1.61-.55-1.4-1.34-1.77-1.34-1.77-1.09-.75.08-.74.08-.74 1.2.09 1.83 1.23 1.83 1.23 1.07 1.82 2.8 1.29 3.48.99.11-.78.42-1.29.77-1.59-2.66-.3-5.46-1.33-5.46-5.9 0-1.3.47-2.36 1.23-3.19-.12-.3-.53-1.52.12-3.17 0 0 1.01-.32 3.3 1.22.96-.27 1.98-.4 3-.4s2.04.13 3 .4c2.28-1.54 3.29-1.22 3.29-1.22.65 1.65.24 2.87.12 3.17.76.83 1.23 1.9 1.23 3.19 0 4.58-2.8 5.6-5.47 5.9.43.37.82 1.1.82 2.22v3.29c0 .32.21.69.83.57A12 12 0 0 0 12 .5Z"/></svg>
            </a>
            <a href="#" target="_blank" rel="noopener" title="Instagram (adicione seu link)">
              <!-- instagram -->
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5Zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5Zm5.75-3a1.25 1.25 0 1 1-1.25 1.25A1.25 1.25 0 0 1 17.75 6.5Z"/></svg>
            </a>
            <a href="#" target="_blank" rel="noopener" title="LinkedIn (adicione seu link)">
              <!-- linkedin -->
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5a2.5 2.5 0 1 0 .02 5 2.5 2.5 0 0 0-.02-5zM3 9h4v12H3zM10 9h3.8v1.7h.05c.53-1 1.83-2.05 3.77-2.05 4.04 0 4.78 2.66 4.78 6.11V21h-4v-5.4c0-1.29-.02-2.95-1.8-2.95-1.8 0-2.08 1.4-2.08 2.85V21h-4V9z"/></svg>
            </a>
          </div>
        </div>
      </div>

      <div class="search">
        <input id="menuSearch" type="search" placeholder="Buscar… ( / )" aria-label="Buscar no menu">
      </div>

      <button class="btn hamburger" aria-controls="menu" aria-expanded="false" id="burger">☰ Menu</button>
      <nav id="menu" aria-label="Seções"><!-- items gerados via JS --></nav>

      <div class="hint" id="hintText">Dicas: 1–9 para trocar • ↑/↓ navegam • Enter abre • Rolagem no topo/rodapé troca seção • Arraste a borda</div>
      <div class="resizer" id="resizer" title="Arraste para redimensionar (duplo clique reseta)"></div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="toolbar">
        <div class="left">
          <span class="title">Visualizando: <strong id="currentTitle">—</strong></span>
        </div>
        <div class="right">
          <button class="btn" id="motionToggle" aria-pressed="false" title="Reduzir movimentos">Movimento: On</button>
          <button class="btn" id="themeToggle" aria-pressed="false" title="Alternar tema">Tema: Escuro</button>
          <button class="btn" id="openNew">Abrir em nova aba</button>
          <button class="btn" id="copyLink">Copiar link</button>
        </div>
      </div>

      <div class="viewer">
        <!-- Faixas “scroll-to-next/prev” -->
        <div id="edgeTop" class="edge" aria-hidden="true"></div>
        <div id="edgeBottom" class="edge" aria-hidden="true"></div>

        <div class="loading" id="loading" aria-hidden="true"><div class="spinner" role="status" aria-label="Carregando"></div></div>
        <iframe id="frame" title="Visualização do portfólio" referrerpolicy="no-referrer"></iframe>
      </div>

      <div class="footer">
        Feito com ❤ — Tema claro/escuro, sidebar redimensionável, atalhos, swipe no mobile e “scroll-to-next”. Se alguma página bloquear *iframe*, use “Abrir em nova aba”.
      </div>
    </main>
  </div>

  <!-- Overlay de atalhos -->
  <div id="kbdOverlay" hidden>
    <div class="kbd-card" role="dialog" aria-modal="true" aria-labelledby="kbdTitle">
      <h2 id="kbdTitle">Atalhos</h2>
      <ul>
        <li><kbd>1–9</kbd> Abrir item do menu</li>
        <li><kbd>↑</kbd>/<kbd>↓</kbd> Navegar no menu</li>
        <li><kbd>Enter</kbd> Abrir selecionado</li>
        <li><kbd>/</kbd> Focar busca</li>
        <li><kbd>?</kbd> Mostrar/fechar esta ajuda</li>
        <li><kbd>Esc</kbd> Fechar</li>
        <li>Rolar no <em>topo</em> = seção anterior • Rolar no <em>rodapé</em> = próxima seção</li>
      </ul>
      <button class="btn" id="kbdClose">Fechar</button>
    </div>
  </div>

  <script>
    /* ===== DATA ===== */
    const PAGES = [
      { id:"blender-projects",    key:1, title:"Blender — Projects",           url:"https://aabproducoes.github.io/Links/blender-projects.html" },
      { id:"blender-animations",  key:2, title:"Blender — Animations",         url:"https://aabproducoes.github.io/Links/blender-animations.html" },
      { id:"gimp-projects",       key:3, title:"GIMP — Projects",              url:"https://aabproducoes.github.io/Links/gimp-projects.html" },
      { id:"music-visualizer",    key:4, title:"Music Player — Visualizer",    url:"https://aabproducoes.github.io/Links/music_player-visualizer.html" },
      { id:"best-shots",          key:5, title:"Best Shots — Carousel",        url:"https://aabproducoes.github.io/Links/best-shots-img-caroussell.html" },
      { id:"animated-background", key:6, title:"Animated Background",          url:"https://aabproducoes.github.io/Links/animated-background.html" },
      { id:"html-play",           key:7, title:"HTML Games — Play",            url:"https://aabproducoes.github.io/Links/HTML_games/HTML-play.html" },
      { id:"translation",         key:8, title:"Translation",                  url:"https://aabproducoes.github.io/Links/Translation/translation.html" },
      // Novo item especial: Certificados (gera página interna com base no TXT)
      { id:"certificados",        key:9, title:"Certificados",                 url:"__internal_certificados__" },
    ];

    const CERTS_BASE = "https://aabproducoes.github.io/Links/Certificados/";
    const CERTS_TXT  = CERTS_BASE + "CertificadosList.txt";

    const els = {
      app: document.getElementById('app'),
      sidebar: document.getElementById('sidebar'),
      menu: document.getElementById('menu'),
      frame: document.getElementById('frame'),
      loading: document.getElementById('loading'),
      currentTitle: document.getElementById('currentTitle'),
      openNew: document.getElementById('openNew'),
      copyLink: document.getElementById('copyLink'),
      burger: document.getElementById('burger'),
      resizer: document.getElementById('resizer'),
      themeToggle: document.getElementById('themeToggle'),
      motionToggle: document.getElementById('motionToggle'),
      body: document.body,
      hintText: document.getElementById('hintText'),
      searchInput: document.getElementById('menuSearch'),
      kbdOverlay: document.getElementById('kbdOverlay'),
      kbdClose: document.getElementById('kbdClose'),
      edgeTop: document.getElementById('edgeTop'),
      edgeBottom: document.getElementById('edgeBottom'),
    };

    const STORE = {
      current: 'aab.portfolio.current',
      theme: 'aab.portfolio.theme',
      width: 'aab.portfolio.sidebarWidth',
      motion: 'aab.portfolio.motion'
    };

    /* ===== MENU RENDER ===== */
    function renderMenu(){
      els.menu.innerHTML = '';
      PAGES.forEach(p=>{
        const btn = document.createElement('button');
        btn.className = 'link';
        btn.dataset.id = p.id;
        btn.dataset.key = String(p.key);
        btn.innerHTML = `
          <span class="dot" aria-hidden="true"></span>
          <span class="label">${p.title}</span>
          <span class="open">${p.key}</span>
        `;
        btn.addEventListener('click', ()=>loadPage(p.id));
        els.menu.appendChild(btn);
      });
      // Atualiza dica dinâmica (1–N)
      const first = PAGES[0]?.key ?? 1;
      const last  = PAGES[PAGES.length-1]?.key ?? PAGES.length;
      els.hintText.textContent = `Dicas: ${first}–${last} para trocar • ↑/↓ navegam • Enter abre • Rolagem no topo/rodapé troca seção • Arraste a borda`;
    }

    /* ===== MENU SEARCH & HIGHLIGHT ===== */
    function highlight(text, query){
      if(!query) return text;
      const re = new RegExp(`(${query.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\\\$&')})`, 'ig');
      return text.replace(re, '<mark>$1</mark>');
    }
    function filterMenu(){
      const q = (els.searchInput?.value || '').trim().toLowerCase();
      document.querySelectorAll('#menu .link').forEach(btn=>{
        const label = btn.querySelector('.label');
        const raw = label?.textContent || '';
        const match = raw.toLowerCase().includes(q);
        btn.style.display = match ? '' : 'none';
        if (label) label.innerHTML = match ? highlight(raw, q) : raw;
      });
    }

    // Focar busca com "/"
    window.addEventListener('keydown', (e)=>{
      const tag = (document.activeElement?.tagName || '').toLowerCase();
      if(e.key === '/' && !['input','textarea'].includes(tag) && !e.ctrlKey && !e.metaKey){
        e.preventDefault();
        els.searchInput?.focus();
      }
    });
    els.searchInput?.addEventListener('input', filterMenu);

    /* ===== STATE ===== */
    function setActive(id){
      document.querySelectorAll('.link').forEach(b=>b.classList.toggle('active', b.dataset.id === id));
    }
    function getCurrentId(){
      const h = (location.hash || '').replace('#','').trim();
      if (PAGES.find(p=>p.id===h)) return h;
      const saved = localStorage.getItem(STORE.current);
      if (PAGES.find(p=>p.id===saved)) return saved;
      return PAGES[0].id;
    }

    function isInternalCertPage(id){
      const p = PAGES.find(x=>x.id===id);
      return p && p.url === "__internal_certificados__";
    }

    function loadPage(id, pushHash=true){
      const item = PAGES.find(p=>p.id===id); if(!item) return;

      // spinner ON
      els.loading.removeAttribute('aria-hidden'); els.loading.style.opacity = '1';

      setActive(id);
      els.currentTitle.textContent = item.title;
      localStorage.setItem(STORE.current, id);
      if (pushHash) history.replaceState(null, "", `#${id}`);

      if (isInternalCertPage(id)){
        buildCertificatesPage().then(html=>{
          els.frame.srcdoc = html;
        }).catch(err=>{
          const safe = escapeHTML(String(err?.message || err || 'Erro desconhecido'));
          els.frame.srcdoc = errorCertificatesHTML(safe);
        });
      } else {
        els.frame.removeAttribute('srcdoc');
        els.frame.src = item.url;
      }

      if (els.sidebar.classList.contains('open')) toggleMenu(false);
    }

    // Fadeout spinner quando iframe termina de carregar (src ou srcdoc)
    els.frame.addEventListener('load', ()=>{
      els.loading.style.transition = 'opacity .35s ease';
      els.loading.style.opacity = '0';
      setTimeout(()=>els.loading.setAttribute('aria-hidden','true'), 360);
      const id = getCurrentId();
      const current = PAGES.find(p=>p.id===id);
      if (current) document.title = `Portfólio — ${current.title}`;
    });

    /* ===== NAVEGAÇÃO ENTRE SEÇÕES ===== */
    function getVisibleLinks(){
      return Array.from(document.querySelectorAll('#menu .link')).filter(el=>el.style.display!=='none');
    }
    function goToIndex(newIdx){
      const links = getVisibleLinks();
      if (!links.length) return;
      const idx = Math.max(0, Math.min(links.length-1, newIdx));
      const id = links[idx].dataset.id;
      loadPage(id);
      links[idx].focus();
    }
    function getCurrentVisibleIndex(){
      const links = getVisibleLinks();
      const id = getCurrentId();
      return Math.max(0, links.findIndex(el=>el.dataset.id===id));
    }
    function goNextSection(){ goToIndex(getCurrentVisibleIndex()+1); }
    function goPrevSection(){ goToIndex(getCurrentVisibleIndex()-1); }

    // Atalhos de setas/enter/números + overlay ajuda
    window.addEventListener('keydown', (e)=>{
      const activeTag = (document.activeElement?.tagName || '').toLowerCase();
      const typing = ['input','textarea'].includes(activeTag);
      if ((e.key === '?' || (e.shiftKey && e.key === '/')) && !typing){
        e.preventDefault(); toggleKbd(els.kbdOverlay.hidden); return;
      }
      if (e.key === 'Escape' && !els.kbdOverlay.hidden){ toggleKbd(false); return; }

      const keyNum = Number(e.key);
      if (keyNum>=1 && keyNum<=PAGES.length){
        const p = PAGES[keyNum-1];
        const target = document.querySelector(`.link[data-id="${p.id}"]`);
        if (target){ target.focus(); loadPage(p.id); }
        return;
      }
      const links = getVisibleLinks();
      const idx = links.findIndex(el=>el.classList.contains('active'));
      if (['ArrowDown','j','J','PageDown'].includes(e.key)){ e.preventDefault?.(); goNextSection(); }
      else if (['ArrowUp','k','K','PageUp'].includes(e.key)){ e.preventDefault?.(); goPrevSection(); }
      else if (e.key === 'Enter'){ const active = links[idx] || links[0]; if (active) loadPage(active.dataset.id); }
    });

    /* Faixas topo/rodapé para trocar seção com a rolagem do mouse */
    const edgeWheel = (dir)=> (e)=>{ 
      if ((dir>0 && e.deltaY>0) || (dir<0 && e.deltaY<0)){ e.preventDefault(); dir>0 ? goNextSection() : goPrevSection(); }
    };
    els.edgeTop.addEventListener('wheel', edgeWheel(-1), {passive:false});
    els.edgeBottom.addEventListener('wheel', edgeWheel(1), {passive:false});

    /* Mensagens vindas do conteúdo interno (Certificados) sinalizando topo/final */
    window.addEventListener('message', (ev)=>{
      const d = ev.data;
      if (!d || typeof d !== 'object') return;
      if (d.aabScrollChain === 'NEXT') goNextSection();
      else if (d.aabScrollChain === 'PREV') goPrevSection();
    });

    /* ===== OVERLAY DE ATALHOS ===== */
    function toggleKbd(show){ els.kbdOverlay.hidden = !show; }
    els.kbdClose?.addEventListener('click', ()=>toggleKbd(false));
    els.kbdOverlay?.addEventListener('click', (e)=>{ if(e.target === els.kbdOverlay) toggleKbd(false); });

    /* ===== TOOLBAR BUTTONS ===== */
    els.openNew.addEventListener('click', ()=>{
      const id = getCurrentId();
      const item = PAGES.find(p=>p.id===id);
      if (!item) return;
      if (isInternalCertPage(id)){
        window.open(CERTS_TXT, '_blank', 'noopener'); // abre a fonte
      } else {
        window.open(item.url, '_blank', 'noopener');
      }
    });

    els.copyLink.addEventListener('click', async ()=>{
      const id = getCurrentId();
      const share = `${location.origin}${location.pathname}#${id}`;
      try{
        await navigator.clipboard.writeText(share);
        els.copyLink.textContent = 'Copiado!';
        setTimeout(()=>els.copyLink.textContent='Copiar link', 1200);
      }catch{
        prompt('Copie o link:', share);
      }
    });

    /* ===== THEME TOGGLE ===== */
    function applyTheme(theme){
      document.body.setAttribute('data-theme', theme);
      localStorage.setItem(STORE.theme, theme);
      const isDark = theme === 'dark';
      els.themeToggle.setAttribute('aria-pressed', String(isDark));
      els.themeToggle.textContent = `Tema: ${isDark ? 'Escuro' : 'Claro'}`;
    }
    function initTheme(){
      const saved = localStorage.getItem(STORE.theme);
      if (saved === 'dark' || saved === 'light'){
        applyTheme(saved);
      } else {
        applyTheme('dark');
      }
    }
    els.themeToggle.addEventListener('click', ()=>{
      const next = (document.body.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
      applyTheme(next);
      if (isInternalCertPage(getCurrentId())) loadPage('certificados', /*pushHash*/false);
    });

    /* ===== REDUZIR MOVIMENTOS ===== */
    function applyMotion(on){
      document.body.classList.toggle('reduced-motion', !on);
      localStorage.setItem(STORE.motion, on ? 'on' : 'off');
      els.motionToggle.setAttribute('aria-pressed', String(!on));
      els.motionToggle.textContent = `Movimento: ${on ? 'On' : 'Off'}`;
    }
    (function initMotion(){
      const saved = localStorage.getItem(STORE.motion);
      applyMotion(saved !== 'off'); // default: On
    })();
    els.motionToggle?.addEventListener('click', ()=>{
      const on = !document.body.classList.contains('reduced-motion');
      applyMotion(!on);
    });

    /* ===== MOBILE MENU ===== */
    function toggleMenu(force){
      const open = typeof force === 'boolean' ? force : !els.sidebar.classList.contains('open');
      els.sidebar.classList.toggle('open', open);
      els.burger?.setAttribute('aria-expanded', String(open));
    }
    els.burger?.addEventListener('click', ()=>toggleMenu());

    /* ===== SWIPE NO MOBILE (abre/fecha sidebar) ===== */
    (function initSwipe(){
      const mq = window.matchMedia('(max-width: 860px)');
      let startX=0, startY=0, tracking=false, openedAtStart=false;

      function onTouchStart(e){
        if(!mq.matches) return;
        const t = e.touches[0];
        startX = t.clientX; startY = t.clientY;
        const nearEdge = startX < 24;
        openedAtStart = els.sidebar.classList.contains('open');
        const withinSidebar = openedAtStart && startX < els.sidebar.getBoundingClientRect().width;
        tracking = nearEdge || withinSidebar;
      }
      function onTouchMove(e){
        if(!tracking) return;
        const t = e.touches[0];
        const dx = t.clientX - startX;
        const dy = Math.abs(t.clientY - startY);
        if (Math.abs(dx) > 12 && dy < 30) e.preventDefault();
      }
      function onTouchEnd(e){
        if(!tracking || !mq.matches) return;
        const t = e.changedTouches[0];
        const dx = t.clientX - startX;
        const threshold = 50;
        if(!openedAtStart && dx > threshold){ toggleMenu(true); }
        else if(openedAtStart && dx < -threshold){ toggleMenu(false); }
        tracking = false;
      }
      window.addEventListener('touchstart', onTouchStart, {passive:true});
      window.addEventListener('touchmove', onTouchMove, {passive:false});
      window.addEventListener('touchend', onTouchEnd, {passive:true});
    })();

    /* ===== SIDEBAR RESIZE ===== */
    (function sidebarResize(){
      const MIN = 240, MAX = 520;
      const saved = parseInt(localStorage.getItem(STORE.width)||'', 10);
      if (!Number.isNaN(saved)) els.sidebar.style.width = Math.max(MIN, Math.min(MAX, saved)) + 'px';

      let resizing = false;
      const onPointerMove = (e)=>{
        if (!resizing) return;
        const rect = els.sidebar.getBoundingClientRect();
        const newW = Math.max(MIN, Math.min(MAX, Math.round(e.clientX - rect.left)));
        els.sidebar.style.width = newW + 'px';
      };
      const stop = ()=>{
        if (!resizing) return;
        resizing = false;
        document.removeEventListener('pointermove', onPointerMove);
        document.removeEventListener('pointerup', stop);
        els.app.classList.remove('resizing');
        const w = parseInt(els.sidebar.style.width,10);
        if (!Number.isNaN(w)) localStorage.setItem(STORE.width, String(w));
      };
      els.resizer.addEventListener('pointerdown', (e)=>{
        if (window.matchMedia('(max-width: 860px)').matches) return;
        resizing = true; e.preventDefault();
        els.app.classList.add('resizing');
        document.addEventListener('pointermove', onPointerMove);
        document.addEventListener('pointerup', stop);
      });
      els.resizer.addEventListener('dblclick', ()=>{
        els.sidebar.style.width = '300px';
        localStorage.setItem(STORE.width, '300');
      });
    })();

    /* ===== UTIL ===== */
    function escapeHTML(str){
      return str.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }

    /* ===== CERTIFICADOS (com filtro interno + postMessage scroll) ===== */
    async function buildCertificatesPage(){
      const theme = document.body.getAttribute('data-theme') || 'dark';
      const resp = await fetch(CERTS_TXT, { cache: 'no-cache' });
      if (!resp.ok) throw new Error(`Falha ao carregar a lista (${resp.status})`);
      const text = await resp.text();

      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const items = [];
      for (const line of lines){
        const mPdf = line.match(/(?:^|\s)([^\s]+\.pdf)(?:\s|$)/i);
        if (!mPdf) continue;
        const pdfName = mPdf[1];
        const url = /^https?:\/\//i.test(pdfName) ? pdfName : (CERTS_BASE + pdfName);

        let desc = '';
        const mDescSpaced = line.match(/\s-\s(.*?)\s-\s/);
        if (mDescSpaced && mDescSpaced[1]) desc = mDescSpaced[1].trim();
        else {
          const mDescLoose = line.match(/-(.*?)-/);
          if (mDescLoose && mDescLoose[1]) desc = mDescLoose[1].trim();
        }
        const display = desc || decodeURIComponent(pdfName.replace(/^.*\//,'').replace(/\.pdf$/i,''));
        items.push({ url, display, tooltip: desc });
      }

      items.sort((a,b)=> a.display.localeCompare(b.display, 'pt-BR', {sensitivity:'base'}));

      const doc = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Certificados</title>
<style>
  html,body{height:100%}
  body[data-theme="dark"]{
    --bg:#0b0d12; --panel:#0f131b; --text:#e6ebf2; --muted:#97a0b0; --accent:#00e0ff; --border:#1a2230; --soft:#111826;
    background:var(--bg); color:var(--text); font:14px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Noto Sans";
  }
  body[data-theme="light"]{
    --bg:#f5f7fb; --panel:#ffffff; --text:#0e1726; --muted:#5d6778; --accent:#007bff; --border:#dfe6ee; --soft:#f2f6fb;
    background:var(--bg); color:var(--text); font:14px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Noto Sans";
  }
  .wrap{ max-width:1100px; margin:0 auto; padding:18px }
  h1{ margin:0 0 8px 0; font-size:16px }
  p.sub{ margin:0 0 16px 0; color:var(--muted) }
  .tools{ display:flex; gap:8px; margin:0 0 12px 0 }
  .tools input{
    flex:1; padding:10px 12px; border-radius:12px;
    border:1px solid color-mix(in oklab, var(--border) 80%, transparent);
    background:var(--soft); color:var(--text); outline:none;
  }
  .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:12px }
  .card{
    background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 85%, transparent), var(--panel));
    border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; align-items:center; gap:10px;
  }
  .icon{
    width:38px; height:38px; border-radius:10px;
    background:linear-gradient(135deg, var(--accent), #21c97a);
    display:grid; place-items:center; color:white; font-weight:700;
  }
  .title{ flex:1; min-width:0 }
  .title a{ color:inherit; text-decoration:none }
  .title a:hover{ text-decoration:underline }
  .hint{ color:var(--muted); font-size:12px; margin-top:8px }
</style>
<base target="_blank">
</head>
<body data-theme="${escapeHTML(theme)}">
  <div class="wrap">
    <h1>Certificados</h1>
    <p class="sub">Passe o mouse para ver a descrição (entre hífens) como tooltip. Use a busca para filtrar.</p>
    <div class="tools">
      <input id="certSearch" type="search" placeholder="Filtrar certificados…" aria-label="Filtrar certificados">
    </div>
    <div id="grid" class="grid">
      ${items.map(it=>`
        <div class="card" title="${escapeHTML(it.tooltip || it.display)}" data-text="${escapeHTML((it.display + ' ' + (it.tooltip||'')).toLowerCase())}">
          <div class="icon">PDF</div>
          <div class="title">
            <a href="${escapeHTML(it.url)}" title="${escapeHTML(it.tooltip || it.display)}">${escapeHTML(it.display)}</a>
          </div>
        </div>
      `).join('')}
    </div>
    ${items.length ? '' : `<p class="hint">Nenhum PDF encontrado em <code>CertificadosList.txt</code>. Verifique o conteúdo.</p>`}
    <p class="hint">Fonte: <a href="${escapeHTML(CERTS_TXT)}">CertificadosList.txt</a></p>
  </div>
  <script>
    const input = document.getElementById('certSearch');
    const cards = Array.from(document.querySelectorAll('.card'));
    function doFilter(){
      const q = (input.value || '').trim().toLowerCase();
      cards.forEach(c=>{
        const t = c.getAttribute('data-text') || '';
        c.style.display = t.includes(q) ? '' : 'none';
      });
    }
    input?.addEventListener('input', doFilter);

    // Scroll chaining: ao chegar ao topo/final e continuar rolando, avisa o parent.
    let lastWheelTime = 0;
    window.addEventListener('wheel', (e)=>{
      const now = Date.now();
      if (now - lastWheelTime < 120) return; // simples debouncer
      lastWheelTime = now;

      const atTop = window.scrollY <= 0;
      const atBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 2;

      if (e.deltaY < 0 && atTop){
        window.parent.postMessage({ aabScrollChain: 'PREV' }, '*');
      } else if (e.deltaY > 0 && atBottom){
        window.parent.postMessage({ aabScrollChain: 'NEXT' }, '*');
      }
    }, {passive:true});
  </script>
</body>
</html>`;
      return doc;
    }

    function errorCertificatesHTML(msg){
      const theme = document.body.getAttribute('data-theme') || 'dark';
      return `
<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Erro</title>
<style>
 body[data-theme="dark"]{--bg:#0b0d12;--text:#e6ebf2;--muted:#97a0b0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui}
 body[data-theme="light"]{--bg:#f5f7fb;--text:#0e1726;--muted:#5d6778;background:var(--bg);color:var(--text);font:14px/1.5 system-ui}
 .wrap{max-width:900px;margin:0 auto;padding:18px}
 code{background:rgba(127,127,127,.15);padding:2px 6px;border-radius:6px}
 a{color:inherit}
</style></head>
<body data-theme="${escapeHTML(theme)}">
  <div class="wrap">
    <h1>Não foi possível carregar os certificados</h1>
    <p class="hint">Detalhe: <code>${msg}</code></p>
    <p>Tente abrir diretamente: <a href="${escapeHTML(CERTS_TXT)}">${escapeHTML(CERTS_TXT)}</a></p>
  </div>
</body></html>`;
    }

    /* ===== INIT ===== */
    renderMenu();
    initTheme();
    filterMenu();

    window.addEventListener('hashchange', ()=>{
      const id = getCurrentId();
      loadPage(id, /*pushHash*/false);
    });
    loadPage(getCurrentId());
  </script>
</body>
</html>
